<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Movie Graph Explorer</title>
<style>
  body { font-family: Arial; margin: 0; background:#121212; color:#eee;}
  header { background:#1f1f1f; padding:1rem; text-align:center; font-size:1.5rem;}
  .movies-row { display:flex; flex-wrap:wrap; justify-content:center; margin:1rem; gap:1rem;}
  .movie-card { background:#242424; width:180px; cursor:pointer; overflow:hidden; border-radius:10px; transition:transform 0.2s;}
  .movie-card:hover { transform:scale(1.05); background:#333;}
  .movie-card img { width:100%; border-bottom:1px solid #444;}
  .movie-card h3 { margin:0.5rem; font-size:1rem;}
  .movie-card p { margin:0.2rem 0.5rem 0.5rem 0.5rem; font-size:0.85rem; color:#aaa;}
  .main-movie { text-align:center; margin:2rem auto; max-width:400px; padding:1rem; background:#1f1f1f; border-radius:10px;}
  .main-movie img { width:100%; border-radius:10px;}
  .section-title { text-align:center; margin:1.5rem 0 0.5rem 0; font-size:1.2rem; color:#fff;}
  .home-btn { display:block; margin:1rem auto; padding:0.5rem 1rem; background:#333; color:#fff; border:none; border-radius:5px; cursor:pointer;}
  .home-btn:hover { background:#555;}
</style>
</head>
<body>

<header>üé¨ Movie Graph Explorer</header>

<!-- üî• LOGIN + REGISTER BOX -->
<div id="authBox" style="text-align:center; margin:1rem;">
  <h2>Login / Register</h2>
  <input id="username" placeholder="Username" style="padding:5px;"><br><br>
  <input id="password" type="password" placeholder="Password" style="padding:5px;"><br><br>

  <button onclick="register()" style="padding:6px 12px;">Register</button>
  <button onclick="login()" style="padding:6px 12px;">Login</button>

  <p id="authMsg"></p>
</div>

<button class="home-btn" onclick="showHome()">üè† Home</button>

<section id="movieList" class="movies-row"></section>
<section id="mainMovie" class="main-movie"></section>

<h2 class="section-title">Movies by Same Director</h2>
<section id="directorMovies" class="movies-row"></section>

<h2 class="section-title">Movies of Same Genre</h2>
<section id="genreMovies" class="movies-row"></section>

<script>
/* ---------------------------
    LOAD ALL MOVIES ON HOME
---------------------------- */
async function loadMovies() {
  const res = await fetch("/movies");
  const movies = await res.json();
  const list = document.getElementById("movieList");

  list.innerHTML = "";
  document.getElementById("mainMovie").innerHTML = "";
  document.getElementById("directorMovies").innerHTML = "";
  document.getElementById("genreMovies").innerHTML = "";

  movies.forEach(m => {
    const card = document.createElement("div");
    card.className = "movie-card";

    card.innerHTML = `
      <img src="${m.poster}" alt="${m.title}">
      <h3>${m.title}</h3>
      <p>${m.director}</p>
    `;

    card.onclick = () => selectMovie(m._key);

    list.appendChild(card);
  });
}

/* ---------------------------
    LOAD SELECTED MOVIE
---------------------------- */
async function selectMovie(key) {
  const res = await fetch(`/related/${encodeURIComponent(key)}`);
  const data = await res.json();

  document.getElementById("movieList").innerHTML = "";
  document.getElementById("directorMovies").innerHTML = "";
  document.getElementById("genreMovies").innerHTML = "";

  const main = document.getElementById("mainMovie");
  main.innerHTML = `
    <img src="${data.main.poster}" alt="${data.main.title}">
    <h2>${data.main.title}</h2>
    <p>Director: ${data.main.director}</p>
    <p>Genre: ${data.main.genre}</p>
  `;

  data.byDirector.forEach(m => {
    const card = document.createElement("div");
    card.className = "movie-card";
    card.innerHTML = `
      <img src="${m.poster}">
      <h3>${m.title}</h3>
      <p>${m.director}</p>
    `;
    card.onclick = () => selectMovie(m._key);
    document.getElementById("directorMovies").appendChild(card);
  });

  data.byGenre.forEach(m => {
    const card = document.createElement("div");
    card.className = "movie-card";
    card.innerHTML = `
      <img src="${m.poster}">
      <h3>${m.title}</h3>
      <p>${m.director}</p>
    `;
    card.onclick = () => selectMovie(m._key);
    document.getElementById("genreMovies").appendChild(card);
  });
}

/* ---------------------------
    GO BACK TO HOME
---------------------------- */
function showHome() { loadMovies(); }

/* ---------------------------
   üîê REGISTER USER
---------------------------- */
async function register() {
  const username = document.getElementById("username").value;
  const password = document.getElementById("password").value;

  const res = await fetch("/register", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username, password }),
  });

  const data = await res.json();
  document.getElementById("authMsg").innerText =
    data.error || "Account created!";
}

/* ---------------------------
   üîë LOGIN USER
---------------------------- */
async function login() {
  const username = document.getElementById("username").value;
  const password = document.getElementById("password").value;

  const res = await fetch("/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username, password }),
  });

  const data = await res.json();

  if (data.error) {
    document.getElementById("authMsg").innerText = data.error;
    return;
  }

  // ‚úÖ LOGIN SUCCESS
  document.getElementById("authBox").style.display = "none";

  // Show welcome + logout
  const header = document.querySelector("header");
  header.innerHTML = `üé¨ Movie Graph Explorer - Welcome, ${data.username} 
    <button onclick="logout()" style="margin-left:1rem;padding:4px 8px;">Log Out</button>`;

  loadMovies(); // reload movies after login
}
//Log out
function logout() {
  // Show login box again
  document.getElementById("authBox").style.display = "block";

  // Reset header
  document.querySelector("header").innerText = "üé¨ Movie Graph Explorer";

  // Clear username/password fields and message
  document.getElementById("username").value = "";
  document.getElementById("password").value = "";
  document.getElementById("authMsg").innerText = "";

  loadMovies();
}


loadMovies();
</script>
</body>
</html>
