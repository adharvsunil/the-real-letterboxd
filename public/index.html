<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Movie Graph Explorer</title>
<style>
  /* ----------------- BODY & GENERAL ----------------- */
  body {
    font-family: Arial, sans-serif;
    margin: 0;
    background: #141414; /* Letterboxd dark bg */
    color: #fff;
  }

  header {
    background: #1b1b1b;
    padding: 1rem;
    text-align: center;
    font-size: 1.5rem;
    color: #fff;
  }

  .movies-row {
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    margin: 1rem;
    gap: 1rem;
  }

  .movie-card {
    background: #1f1f1f; /* Letterboxd-style card bg */
    width: 180px;
    cursor: pointer;
    overflow: hidden;
    border-radius: 6px;
    transition: transform 0.2s, background 0.2s;
  }

  .movie-card:hover {
    transform: scale(1.05);
    background: #2a2a2a;
  }

  .movie-card img {
    width: 100%;
    border-bottom: 1px solid #333;
  }

  .movie-card h3 {
    margin: 0.5rem;
    font-size: 1rem;
  }

  .movie-card p {
    margin: 0.2rem 0.5rem 0.5rem 0.5rem;
    font-size: 0.85rem;
    color: #aaa;
  }

  .main-movie {
    text-align: center;
    margin: 2rem auto;
    max-width: 400px;
    padding: 1rem;
    background: #1b1b1b;
    border-radius: 8px;
  }

  .main-movie img {
    width: 100%;
    border-radius: 8px;
  }

  .section-title {
    text-align: left;
    margin: 1rem 1rem 0.5rem 1rem;
    font-size: 1.2rem;
    color: #ffb400; /* Letterboxd orange accent */
    display: none; /* hidden on homepage */
  }

  .home-btn {
    display: block;
    margin: 1rem auto;
    padding: 0.5rem 1rem;
    background: #2a2a2a;
    color: #ffb400; /* Letterboxd accent */
    border: none;
    border-radius: 5px;
    cursor: pointer;
  }

  .home-btn:hover {
    background: #3a3a3a;
  }

  #authBox {
    text-align: center;
    margin: 1rem;
  }

  #authBox input {
    padding: 5px;
  }

  #authBox button {
    padding: 6px 12px;
  }
</style>
</head>
<body>

<header>üé¨ Movie Log</header>

<!-- üî• LOGIN + REGISTER BOX -->
<div id="authBox">
  <h2>Login / Register</h2>
  <input id="username" placeholder="Username"><br><br>
  <input id="password" type="password" placeholder="Password"><br><br>
  <button onclick="register()">Register</button>
  <button onclick="login()">Login</button>
  <p id="authMsg"></p>
</div>

<button class="home-btn" onclick="showHome()">üè† Home</button>

<section id="movieList" class="movies-row"></section>
<section id="mainMovie" class="main-movie"></section>

<h2 id="directorTitle" class="section-title">Movies by Same Director</h2>
<section id="directorMovies" class="movies-row"></section>

<h2 id="genreTitle" class="section-title">Movies of Same Genre</h2>
<section id="genreMovies" class="movies-row"></section>

<script>
/* --------------------------- LOAD ALL MOVIES ON HOME ---------------------------- */
async function loadMovies() {
  const res = await fetch("/movies");
  const movies = await res.json();
  const list = document.getElementById("movieList");

  list.innerHTML = "";
  document.getElementById("mainMovie").innerHTML = "";
  document.getElementById("directorMovies").innerHTML = "";
  document.getElementById("genreMovies").innerHTML = "";

  // Hide related sections on homepage
  document.getElementById("directorTitle").style.display = "none";
  document.getElementById("genreTitle").style.display = "none";

  movies.forEach(m => {
    const card = document.createElement("div");
    card.className = "movie-card";
    card.innerHTML = `
      <img src="${m.poster}" alt="${m.title}">
      <h3>${m.title}</h3>
      <p>${m.director}</p>
    `;
    card.onclick = () => selectMovie(m._key);
    list.appendChild(card);
  });
}

/* --------------------------- LOAD SELECTED MOVIE ---------------------------- */
async function selectMovie(key) {
  const res = await fetch(`/related/${encodeURIComponent(key)}`);
  const data = await res.json();

  document.getElementById("movieList").innerHTML = "";
  document.getElementById("directorMovies").innerHTML = "";
  document.getElementById("genreMovies").innerHTML = "";

  const main = document.getElementById("mainMovie");
  main.innerHTML = `
    <img src="${data.main.poster}" alt="${data.main.title}">
    <h2>${data.main.title}</h2>
    <p>Director: ${data.main.director}</p>
    <p>Genre: ${data.main.genre}</p>
  `;

  // Show related sections now
  document.getElementById("directorTitle").style.display = "block";
  document.getElementById("genreTitle").style.display = "block";

  data.byDirector.forEach(m => {
    const card = document.createElement("div");
    card.className = "movie-card";
    card.innerHTML = `
      <img src="${m.poster}">
      <h3>${m.title}</h3>
      <p>${m.director}</p>
    `;
    card.onclick = () => selectMovie(m._key);
    document.getElementById("directorMovies").appendChild(card);
  });

  data.byGenre.forEach(m => {
    const card = document.createElement("div");
    card.className = "movie-card";
    card.innerHTML = `
      <img src="${m.poster}">
      <h3>${m.title}</h3>
      <p>${m.director}</p>
    `;
    card.onclick = () => selectMovie(m._key);
    document.getElementById("genreMovies").appendChild(card);
  });
}

/* --------------------------- GO BACK TO HOME ---------------------------- */
function showHome() {
  loadMovies();
}

/* --------------------------- üîê REGISTER USER ---------------------------- */
async function register() {
  const username = document.getElementById("username").value;
  const password = document.getElementById("password").value;

  const res = await fetch("/register", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username, password }),
  });

  const data = await res.json();
  document.getElementById("authMsg").innerText = data.error || "Account created!";
}

/* --------------------------- üîë LOGIN USER ---------------------------- */
async function login() {
  const username = document.getElementById("username").value;
  const password = document.getElementById("password").value;

  const res = await fetch("/login", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ username, password }),
  });

  const data = await res.json();

  if (data.error) {
    document.getElementById("authMsg").innerText = data.error;
    return;
  }

  document.getElementById("authBox").style.display = "none";

  const header = document.querySelector("header");
  header.innerHTML = `üé¨ Movie Graph Explorer - Welcome, ${data.username} 
    <button onclick="logout()" style="margin-left:1rem;padding:4px 8px;">Log Out</button>`;

  loadMovies();
}

function logout() {
  document.getElementById("authBox").style.display = "block";
  document.querySelector("header").innerText = "üé¨ Movie Graph Explorer";
  document.getElementById("username").value = "";
  document.getElementById("password").value = "";
  document.getElementById("authMsg").innerText = "";
  loadMovies();
}

// Initial load
loadMovies();
</script>
</body>
</html>
